// Function Node: Restore Data After Sapling Detection
// Place after Sapling_AI_Detection node

// Get the Sapling API response
const saplingResult = $input.first().json;

// Get our preserved original data
const originalData = $input.first().json.originalData;

// Calculate the AI score percentage
const aiScore = (saplingResult.score * 100) || 0;

// Update the data structure with the detection results
return [
  {
    json: {
      ...originalData, // Restore the complete original data structure
      current: {
        ...originalData.current,
        aiScore: aiScore,
        requiresRewrite: aiScore >= originalData.workflow.targetAIScore
      },
      timestamps: {
        ...originalData.timestamps,
        lastDetection: new Date().toISOString()
      }
    }
  }
];
